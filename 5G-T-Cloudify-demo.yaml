tosca_definitions_version: cloudify_dsl_1_3

imports:
  - http://www.getcloudify.org/spec/cloudify/4.2/types.yaml
  - http://www.getcloudify.org/spec/openstack-plugin/2.7.4/plugin.yaml
  - openstack-deployment.yaml

node_templates:
  VNF1:
    type: cloudify.openstack.nodes.Server
    properties:
      install_agent: false
      image: { get_input: image_id }
      flavor: { get_input: flavor_id }
      management_network_name: { get_input: network_name }
      openstack_config: *openstack_config
    relationships:
      - target: Port_VM1
        type: cloudify.openstack.server_connected_to_port


  VNF2:
    type: cloudify.openstack.nodes.Server
    properties:
      install_agent: false
      image: { get_input: image_id }
      flavor: { get_input: flavor_id }
      management_network_name: { get_input: network_name }
      openstack_config: *openstack_config
    relationships:
      - target: Port_VM2
        type: cloudify.openstack.server_connected_to_port


  Net1:
    type: cloudify.openstack.nodes.Network
    properties:
      resource_id: {get_input: network_id}
      use_external_resource: true
      openstack_config: *openstack_config

  Port_VM1:
    type: cloudify.openstack.nodes.Port
    properties:
      resource_id: 'Port_VNF1'
      openstack_config: *openstack_config
    relationships:
        - type: cloudify.relationships.contained_in
          target: Net1

  Port_VM2:
    type: cloudify.openstack.nodes.Port
    properties:
      resource_id: 'Port_VNF2'
      openstack_config: *openstack_config
    relationships:
        - type: cloudify.relationships.contained_in
          target: Net1
                               


